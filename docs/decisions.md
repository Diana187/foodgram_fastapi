# Architectural Decisions — Foodgram FastAPI

## [2025-09-28] FastAPI вместо Django
- **Контекст:** Изначально бэкенд был на Django + DRF. Необходимо переписать на FastAPI, сохранив контракт v1, чтобы фронтенд продолжил работать без изменений.
- **Решение:** Использовать FastAPI + Pydantic + SQLAlchemy (через Alembic для миграций).
- **Причина:** 
  - Поддержка async.
  - Более лёгкий фреймворк под микросервисы.
  - Контракт проще синхронизировать через OpenAPI.

---

## [2025-09-29] TokenAuth вместо JWT
- **Контекст:** Фронт ожидает схему `Authorization: Token <auth_token>`.
- **Решение:** Реализовать токен-аутентификацию (login/logout) совместимую с существующим контрактом.
- **Причина:** 
  - Сохраняем полную совместимость с фронтом.
  - Минимум изменений при миграции.

---

## [2025-09-30] Контракт v1 — FROZEN
- **Контекст:** API-контракт описан в `openapi-schema.yml`. Фронт интегрирован строго под текущие схемы и эндпоинты.
- **Решение:** Заморозить контракт v1. Любые изменения в контракте возможны только с фиксацией в `contract_deltas.md`.
- **Причина:** 
  - Гарантия, что фронт не сломается.
  - Возможность эволюции API через `v2`.

---

## [2025-09-30] Формат изображений
- **Контекст:** Фронт при создании рецепта отправляет картинку как Base64 data URL. На выводе контракт ждёт абсолютный URL к картинке.
- **Решение:** 
  - На входе: поддерживать Base64 data URL.
  - На выходе: формировать абсолютный URL (через `MEDIA_URL` + CDN/статик).
- **Причина:** Полная совместимость с существующим фронтом.

---

## [2025-10-01] Единый формат ошибок
- **Контекст:** Контракт описывает стандартные ответы: ValidationError, AuthenticationError, PermissionDenied, NotFound.
- **Решение:** 
  - Все ошибки формировать по `components.responses`.
  - Использовать Pydantic-схемы для единообразия.
- **Причина:** 
  - Упрощает фронту обработку ошибок.
  - Сохраняется DRF-совместимый формат.
