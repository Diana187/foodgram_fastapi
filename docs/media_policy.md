# media_policy.md

## Цель
Зафиксировать, как проект работает с медиа (в основном — изображениями рецептов) и что сохраняется при переходе на FastAPI.

---

## Текущее состояние
- `Recipe.image`: `ImageField(upload_to='recipes/image/')`
- Приём/отдача — через `Base64ImageField` (base64-строка в JSON).
- Изображения публичные, авторизация не требуется.

---

## При миграции на FastAPI
- Сохраняем поддержку **base64** для обратной совместимости.  
- Добавляем **multipart-загрузку** (файлом) с возвратом **URL**.

---

## Хранилище
- Локально: `MEDIA_ROOT=/var/app/media`, `MEDIA_URL=/media/recipes/image/`
- В проде допускается S3/MinIO (переменные окружения `S3_BUCKET`, `S3_ACCESS_KEY` и т.п.)
- Имена файлов — UUID, без исходных имён пользователей.

---

## Ограничения и безопасность
- Допустимые типы: `image/jpeg`, `image/png`, `image/webp`
- Макс. размер: 5 MB  
- EXIF-метаданные удаляются  
- SVG — запрещён  
- При удалении рецепта связанные файлы также удаляются.

---

## API-контракт
- **POST/PUT** рецепта — поле `image` принимает base64 или multipart-файл.  
- **GET** рецепта — поле `image` возвращает URL или `null`.  
- Для старого фронта base64-вход остаётся поддержанным.

---

## Итог
✅ Поддержка старого контракта  
✅ Безопасные загрузки  
✅ Возможность перехода на URL-базированные медиа в будущем
